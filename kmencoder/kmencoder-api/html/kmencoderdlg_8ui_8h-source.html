<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>kmencoderdlg.ui.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.8.1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>kmencoderdlg.ui.h</h1><div class="fragment"><pre>00001 <font class="comment">/****************************************************************************</font>
00002 <font class="comment">** ui.h extension file, included from the uic-generated form implementation.</font>
00003 <font class="comment">**</font>
00004 <font class="comment">** If you wish to add, delete or rename slots use Qt Designer which will</font>
00005 <font class="comment">** update this file, preserving your code. Create an init() slot in place of</font>
00006 <font class="comment">** a constructor, and a destroy() slot in place of a destructor.</font>
00007 <font class="comment">*****************************************************************************/</font>
00008 
00009 <font class="keywordtype">void</font> kmencoderdlgForm::start()<font class="keyword"></font>
00010 <font class="keyword"></font>{
00011     start_encode = TRUE;
00012     endpos = endpositionCheckBox-&gt;isChecked();
00013     turn.setOutputFileName( otputKURLRequester-&gt;url() );
00014     
00015     prebegin();   
00016 }
00017 
00018 <font class="keywordtype">void</font> kmencoderdlgForm::readFromStdout()<font class="keyword"></font>
00019 <font class="keyword"></font>{
00020     <font class="comment">//Write to the STDOUT TextEdit</font>
00021     outputTextEdit-&gt;append( proc-&gt;readStdout() ); 
00022 }
00023 
00024 
00025 
00026 <font class="keywordtype">void</font> kmencoderdlgForm::manageSourceComboBox()<font class="keyword"></font>
00027 <font class="keyword"></font>{
00028     <font class="keywordflow">if</font>( sourceComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Select Source"</font> ) )
00029     selected = srcSELECT_SOURCE;
00030     <font class="keywordflow">if</font>( sourceComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"File"</font> ) )
00031     selected = srcFILE;
00032     <font class="keywordflow">if</font>( sourceComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"PlayList"</font> ) )
00033     selected = srcPLAYLIST;
00034     <font class="keywordflow">if</font>( sourceComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"URL"</font> ) )
00035     selected = srcURL;
00036     <font class="keywordflow">if</font>( sourceComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"TV"</font> ) )
00037     selected = srcTV;
00038     <font class="keywordflow">if</font>( sourceComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"VCD"</font> ) )
00039     selected = srcVCD;
00040     <font class="keywordflow">if</font>( sourceComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"DVD"</font> ) )
00041     selected = srcDVD;
00042     
00043     kmenselected.setSource( selected );
00044     
00045     <font class="keywordflow">switch</font>( kmenselected.getSource() ) {
00046     <font class="keywordflow">case</font> srcSELECT_SOURCE: {
00047         <font class="keywordflow">break</font>;
00048     }
00049     <font class="keywordflow">case</font> srcFILE: {
00050         turn.setEnabled( <font class="stringliteral">"FILE"</font> );
00051         default_settings();
00052         
00053         getFileGroupStuff();
00054         <font class="keywordflow">break</font>;
00055     }
00056     <font class="keywordflow">case</font> srcPLAYLIST: {
00057         turn.setEnabled( <font class="stringliteral">"PLAYLIST"</font> );
00058         default_settings();
00059         <font class="keywordflow">break</font>;
00060     }
00061     <font class="keywordflow">case</font> srcURL: {
00062         turn.setEnabled( <font class="stringliteral">"URL"</font> );
00063         default_settings();
00064         <font class="keywordflow">break</font>;
00065     }
00066     <font class="keywordflow">case</font> srcTV: {
00067         turn.setEnabled( <font class="stringliteral">"TV"</font> );
00068         default_settings();    
00069         <font class="keywordflow">break</font>;
00070     }
00071     <font class="keywordflow">case</font> srcVCD: {
00072         turn.setEnabled( <font class="stringliteral">"VCD"</font> );
00073         default_settings();
00074         
00075         vcd_scan();
00076         <font class="keywordflow">break</font>;
00077     }
00078     <font class="keywordflow">case</font> srcDVD: {
00079         turn.setEnabled( <font class="stringliteral">"DVD"</font> );
00080         default_settings();
00081          
00082         <font class="comment">//Clear the DVD info combo boxes</font>
00083         achannelComboBox-&gt;clear();
00084         subtitleComboBox-&gt;clear();
00085 
00086         dvd_scan();
00087         <font class="keywordflow">break</font>;
00088     }
00089     <font class="keywordflow">default</font>: {
00090         default_settings();
00091         <font class="keywordflow">break</font>;
00092     }
00093     }
00094   
00095     setgroups();
00096     
00097 }
00098 
00099 
00100 <font class="keywordtype">void</font> kmencoderdlgForm::helpkPushButton()<font class="keyword"></font>
00101 <font class="keyword"></font>{
00102 helpMenu = <font class="keyword">new</font> KHelpMenu(<font class="keyword">this</font>, KGlobal::instance()-&gt;aboutData(), <font class="keyword">false</font>);
00103 
00104 HelpKPushButton-&gt;setAutoRepeat( FALSE );
00105 HelpKPushButton-&gt;setPopup(helpMenu-&gt;menu());
00106 }
00107 
00108 
00109 <font class="keywordtype">void</font> kmencoderdlgForm::default_settings()<font class="keyword"></font>
00110 <font class="keyword"></font>{
00111     <font class="comment">//Set Pass Method defaults.</font>
00112     passmethodCheckBox-&gt;setEnabled( TRUE );
00113     passmethodCheckBox-&gt;setChecked( FALSE );
00114     passmethodComboBox-&gt;setDisabled( TRUE );
00115     
00116      <font class="comment">//Set the Default Disabled CheckBoxes.</font>
00117     setendpositiongroup( FALSE );
00118 
00119     <font class="comment">//Set the DEFAULT Disabled GroupBoxes.</font>
00120     setdvdgroup( FALSE );
00121     setfilegroup( FALSE ); 
00122     setplaylistgroup( FALSE );
00123     seturlgroup( FALSE ); 
00124     setvcdgroup( FALSE );
00125     settvgroup( FALSE ); 
00126     setvideogroup( FALSE );
00127     lamemp3GroupBox-&gt;setEnabled( FALSE ); 
00128 
00129     <font class="comment">//Set the Default data values.</font>
00130     cacheSpinBox-&gt;setValue( (miscinfo.getMiscCache()).toInt() ); 
00131     divx4qualitySpinBox-&gt;setValue( 5 );
00132     videobitrateSpinBox-&gt;setValue( (videoinfo.getVideoBitrate()).toInt() );
00133     lameSpinBox-&gt;setValue( 128 );
00134     lamecompresratioSpinBox-&gt;setValue( 1 );
00135     endpositionmegaSpinBox-&gt;setValue( 650 );
00136     endpositionhourSpinBox-&gt;setValue( 0 );
00137     endpositionminutesSpinBox-&gt;setValue( 0 );
00138     endpositionsecondsSpinBox-&gt;setValue( 0 );
00139         
00140     <font class="comment">//Set the Default Checked CheckBoxes.</font>
00141     noskipCheckBox-&gt;setChecked( FALSE );
00142     verboseCheckBox-&gt;setChecked( FALSE );
00143     nosoundCheckBox-&gt;setChecked( FALSE );
00144     lavchighqualityCheckBox-&gt;setChecked( FALSE );
00145     
00146     <font class="comment">//Set the Default ComboBox item.</font>
00147     videosizeComboBox-&gt;setCurrentItem( 0 );
00148     aspectComboBox-&gt;setCurrentText( videoinfo.getVideoAspectMode() );
00149     vqualityComboBox-&gt;setCurrentItem( 0 );
00150     audioqualityComboBox-&gt;setCurrentItem( 0 );
00151     bitrateComboBox-&gt;setCurrentItem( 0 );
00152     amodeComboBox-&gt;setCurrentItem( 0 );
00153     endpositionComboBox-&gt;setCurrentItem( 0 );
00154     lavccodecComboBox-&gt;setCurrentItem( 0 );
00155     
00156     <font class="comment">//Set the Default Slider position.</font>
00157     subtitlepositionSlider-&gt;setValue( 0 );
00158     volumeSlider-&gt;setValue( 0 );
00159     
00160     <font class="comment">//Set Combo Box Defaults.</font>
00161     manageEnableControls();
00162     
00163     manageVideoSizeComboBox(); 
00164     manageWidthChanged();
00165     manageDivx4CodecChanged();
00166     manageLavcCodecChanged();
00167     
00168     manageAudioQualityCombobox();
00169     manageMp3Changed();
00170     
00171     manageEndPositionComboBox();
00172     manageMiscChanged();
00173     
00174     <font class="comment">//manageSelectAudioChannel();</font>
00175     <font class="comment">//manageSubTitlesComboBox();</font>
00176     <font class="comment">//manageTitleChanged();</font>
00177     
00178     manageSoundOnCheckBox();
00179     
00180     manageDVDChanged();
00181     manageCdromChanged();
00182 }
00183 
00184 
00185 <font class="keywordtype">void</font> kmencoderdlgForm::dvd_scan()<font class="keyword"></font>
00186 <font class="keyword"></font>{
00187     new_proc();
00188     
00189     QString dir;
00190     
00191     dir = tmp_dir + <font class="stringliteral">"/kmencoder_test.avi"</font>;
00192     
00193     proc-&gt;addArgument( <font class="stringliteral">"mencoder"</font> );
00194     proc-&gt;addArgument( <font class="stringliteral">"-dvd-device"</font> );
00195     proc-&gt;addArgument( dvdinfo.getDVDDevice() );
00196     proc-&gt;addArgument( <font class="stringliteral">"-dvd"</font> );
00197     proc-&gt;addArgument( <font class="stringliteral">"1"</font> ) ;
00198     proc-&gt;addArgument( <font class="stringliteral">"-v"</font> );
00199     proc-&gt;addArgument( <font class="stringliteral">"-o"</font> );
00200     proc-&gt;addArgument( dir );
00201 
00202     proc-&gt;setCommunication ( 0x04 );
00203 
00204     connect( proc, SIGNAL(readyReadStderr()),
00205          <font class="keyword">this</font>, SLOT(getDVDInfo() ));    
00206 
00207     <font class="comment">//Sart the process.</font>
00208     <font class="keywordflow">if</font> ( !proc-&gt;start() ) {
00209     <font class="comment">// error handling</font>
00210     QMessageBox::critical( 0,
00211                   tr2i18n( <font class="stringliteral">"Error"</font> ),
00212                   tr2i18n( <font class="stringliteral">"Could not scan the DVD!"</font> ) );
00213     } 
00214 }
00215 
00216 
00217 <font class="keywordtype">void</font> kmencoderdlgForm::manageVideoSizeComboBox()<font class="keyword"></font>
00218 <font class="keyword"></font>{
00219     <font class="keywordflow">if</font>(videosizeComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Auto"</font> ) )
00220     vselected = videoAUTO;
00221     <font class="keywordflow">if</font>(videosizeComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Aspect"</font> ) )
00222     vselected = videoASPECT;
00223     <font class="keywordflow">if</font>(videosizeComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Width/Auto Height"</font> ) )
00224     vselected = videoWIDTH;
00225     <font class="keywordflow">if</font>(videosizeComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Width/Height"</font> ) )
00226     vselected = videoWIDTHHEIGHT;
00227     
00228     kmenselected.setVideo( vselected );
00229     
00230     <font class="keywordflow">switch</font>( vselected ) {
00231     <font class="keywordflow">case</font> videoAUTO: {
00232         aspectComboBox-&gt;setEnabled( FALSE );
00233         widthheightGroupBox-&gt;setEnabled( FALSE );
00234         videosizeDefaults();
00235         <font class="keywordflow">break</font>;
00236     }
00237     <font class="keywordflow">case</font> videoASPECT: {
00238         widthheightGroupBox-&gt;setEnabled( FALSE );
00239         aspectComboBox-&gt;setEnabled( TRUE );
00240         videosizeDefaults();
00241         <font class="keywordflow">break</font>;
00242     }
00243     <font class="keywordflow">case</font> videoWIDTH: {
00244         aspectComboBox-&gt;setEnabled( FALSE ); 
00245         widthheightGroupBox-&gt;setEnabled( TRUE );
00246         widthSpinBox-&gt;setEnabled( TRUE );
00247         heightSpinBox-&gt;setEnabled( FALSE ); 
00248         videosizeDefaults();
00249         <font class="keywordflow">break</font>;
00250     }
00251     <font class="keywordflow">case</font> videoWIDTHHEIGHT: {
00252         aspectComboBox-&gt;setEnabled( FALSE ); 
00253         widthheightGroupBox-&gt;setEnabled( TRUE );
00254         widthSpinBox-&gt;setEnabled( TRUE );
00255         heightSpinBox-&gt;setEnabled( TRUE ); 
00256         videosizeDefaults();
00257         <font class="keywordflow">break</font>;
00258     }
00259     <font class="keywordflow">default</font>: <font class="keywordflow">break</font>;
00260     }    
00261     manageWidthChanged();
00262     
00263 }
00264 
00265 
00266 <font class="keywordtype">void</font> kmencoderdlgForm::videosizeDefaults()<font class="keyword"></font>
00267 <font class="keyword"></font>{
00268     widthSpinBox-&gt;setValue( ( videoinfo.getVideoWidth() ).toInt() );
00269     heightSpinBox-&gt;setValue( ( videoinfo.getVideoHeight() ).toInt() );
00270 }
00271 
00272 
00273 <font class="keywordtype">void</font> kmencoderdlgForm::videoQualityOutput()<font class="keyword"></font>
00274 <font class="keyword"></font>{
00275     <font class="keywordflow">if</font>(vqualityComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Exact Copy"</font> ) )
00276     vqselected = vqEXACTCOPY;
00277     <font class="keywordflow">if</font>(vqualityComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"DivX 4"</font> ) )
00278     vqselected = vqDIVX4;
00279     <font class="keywordflow">if</font>(vqualityComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"lavc"</font> ) )
00280     vqselected = vqLAVC;
00281     
00282     kmenselected.setVideoQuality( vqselected );
00283     
00284     <font class="keywordflow">switch</font>( vqselected ){
00285     <font class="keywordflow">case</font> vqEXACTCOPY: {
00286         videobitrateSpinBox-&gt;setEnabled( FALSE ); 
00287         divx4GroupBox-&gt;setEnabled( FALSE ); 
00288         lavcGroupBox-&gt;setEnabled( FALSE ); 
00289         aspectComboBox-&gt;setEnabled( FALSE );
00290         widthheightGroupBox-&gt;setEnabled( FALSE );
00291         videosizeComboBox-&gt;setEnabled( FALSE );
00292         videosizeComboBox-&gt;setCurrentItem( 0 );
00293 <font class="comment">//      videosizeDefaults();</font>
00294         <font class="keywordflow">break</font>;
00295     }
00296     <font class="keywordflow">case</font> vqDIVX4: {
00297         manageDivx4CodecChanged();
00298         
00299         videosizeComboBox-&gt;setEnabled( TRUE ); 
00300         lavcGroupBox-&gt;setEnabled( FALSE ); 
00301         divx4GroupBox-&gt;setEnabled( TRUE );
00302         videobitrateSpinBox-&gt;setEnabled( TRUE );  
00303         <font class="keywordflow">break</font>;
00304     }
00305     <font class="keywordflow">case</font> vqLAVC: {
00306         manageLavcCodecChanged();
00307         
00308         videosizeComboBox-&gt;setEnabled( TRUE ); 
00309         lavcGroupBox-&gt;setEnabled( TRUE ); 
00310         divx4GroupBox-&gt;setEnabled( FALSE ); 
00311         videobitrateSpinBox-&gt;setEnabled( TRUE );  
00312         <font class="keywordflow">break</font>;
00313     }
00314     <font class="keywordflow">default</font>: <font class="keywordflow">break</font>;
00315     }   
00316 }
00317 
00318 
00319 <font class="keywordtype">void</font> kmencoderdlgForm::manageAudioQualityCombobox()<font class="keyword"></font>
00320 <font class="keyword"></font>{
00321     <font class="keywordflow">if</font>(audioqualityComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Exact Copy"</font> ) )
00322     aqselected = aqEXACTCOPY;
00323     <font class="keywordflow">if</font>(audioqualityComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"MP3"</font> ) )
00324     aqselected = aqMP3;
00325     
00326     kmenselected.setAudioQuality( aqselected );
00327     
00328     <font class="keywordflow">switch</font>( aqselected ){
00329     <font class="keywordflow">case</font> aqEXACTCOPY: {
00330         lamemp3GroupBox-&gt;setEnabled( FALSE ); 
00331         <font class="keywordflow">break</font>;
00332     }
00333     <font class="keywordflow">case</font> aqMP3: {
00334         manageMp3Changed();
00335         
00336         lamemp3GroupBox-&gt;setEnabled( TRUE );        
00337         bitrateComboBox-&gt;setEnabled( TRUE ); 
00338         lameSpinBox-&gt;setEnabled( TRUE ); 
00339         amodeComboBox-&gt;setEnabled( TRUE ); 
00340         lamecompresratioSpinBox-&gt;setEnabled( TRUE ); 
00341         volumeSlider-&gt;setEnabled( TRUE ); 
00342         <font class="keywordflow">break</font>;
00343     }
00344     <font class="keywordflow">default</font>: <font class="keywordflow">break</font>;
00345     }   
00346 }
00347 
00348 
00349 <font class="keywordtype">void</font> kmencoderdlgForm::manageEndPositionComboBox()<font class="keyword"></font>
00350 <font class="keyword"></font>{
00351    <font class="comment">// manageMiscChanged();</font>
00352     <font class="keywordflow">if</font>(endpositionComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Mega Bytes"</font> ) )
00353     epselected = epMEGABYTES;
00354     <font class="keywordflow">if</font>(endpositionComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"Time"</font> ) )
00355     epselected = epTIME;
00356     
00357     kmenselected.setEndPos( epselected );
00358     
00359     <font class="keywordflow">switch</font>( epselected ){
00360     <font class="keywordflow">case</font> epMEGABYTES: {
00361         endpositionmegaSpinBox-&gt;setEnabled( TRUE ); 
00362         endpositionhourSpinBox-&gt;setEnabled( FALSE ); 
00363         endpositionminutesSpinBox-&gt;setEnabled( FALSE ); 
00364         endpositionsecondsSpinBox-&gt;setEnabled( FALSE ); 
00365         miscinfo.setMiscEndPosMega( endpositionmegaSpinBox-&gt;text() );
00366         <font class="keywordflow">break</font>;
00367     }
00368     <font class="keywordflow">case</font> epTIME: {
00369         endpositionmegaSpinBox-&gt;setEnabled( FALSE ); 
00370         endpositionhourSpinBox-&gt;setEnabled( TRUE ); 
00371         endpositionminutesSpinBox-&gt;setEnabled( TRUE ); 
00372         endpositionsecondsSpinBox-&gt;setEnabled( TRUE ); 
00373         miscinfo.setMiscEndPosTime( endpositionhourSpinBox-&gt;text(),
00374                                   endpositionminutesSpinBox-&gt;text(),
00375                                   endpositionsecondsSpinBox-&gt;text() );
00376         <font class="keywordflow">break</font>;
00377     }
00378     <font class="keywordflow">default</font>: <font class="keywordflow">break</font>;
00379     }
00380 }
00381 
00382 
00383 <font class="keywordtype">void</font> kmencoderdlgForm::setdvdgroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00384 <font class="keyword"></font>{  
00385     dvdGroupBox-&gt;setEnabled( set_it );  
00386     dvdvideoGroupBox-&gt;setEnabled( set_it ); 
00387     dvdaudioGroupBox-&gt;setEnabled( set_it ); 
00388     
00389     dvdtittleSpinBox-&gt;setEnabled( set_it ); 
00390     dvdangleSpinBox-&gt;setEnabled( set_it ); 
00391     dvd1stchapterSpinBox-&gt;setEnabled( set_it );
00392     dvdlastchapterSpinBox-&gt;setEnabled( set_it );
00393     dvdtittleSpinBox-&gt;setValue( (dvdinfo.getDVDTitle_selected() ).toInt() );
00394     dvdangleSpinBox-&gt;setValue( (dvdinfo.getDVDAngle_selected() ).toInt() ); 
00395     dvd1stchapterSpinBox-&gt;setValue( (dvdinfo.getDVD1stChapter() ).toInt() ); 
00396     dvdlastchapterSpinBox-&gt;setValue( (dvdinfo.getDVDLastChapter() ).toInt() );
00397     
00398     enablesubCheckBox-&gt;setEnabled( set_it );
00399     enablesubCheckBox-&gt;setChecked( FALSE );
00400       
00401     subtitleComboBox-&gt;setDisabled( set_it ); 
00402     subtitlepositionSlider-&gt;setEnabled( set_it );   
00403     achannelComboBox-&gt;setEnabled( set_it );
00404     
00405     audiolanguageLineEdit-&gt;setEnabled( set_it );
00406     audioformatLineEdit-&gt;setEnabled( set_it );
00407     
00408     dvddeviceKURLRequester-&gt;setEnabled( TRUE );  
00409     dvddeviceKURLRequester-&gt;setURL( dvdinfo.getDVDDevice() );
00410 }
00411 
00412 
00413 <font class="keywordtype">void</font> kmencoderdlgForm::setendpositiongroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00414 <font class="keyword"></font>{
00415     endpositionCheckBox-&gt;setEnabled( set_it  );
00416    <font class="comment">// endpositionComboBox-&gt;setEnabled( set_it  );    </font>
00417    <font class="comment">// endpositionGroupBox-&gt;setEnabled( set_it  );</font>
00418     endpositionCheckBox-&gt;setChecked( FALSE );
00419     manageEndPositionComboBox();    
00420 }
00421 
00422 
00423 <font class="keywordtype">void</font> kmencoderdlgForm::setfilegroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00424 <font class="keyword"></font>{
00425     fileGroupBox-&gt;setEnabled( set_it ); 
00426     fileKURLRequester-&gt;setEnabled( set_it );
00427 }
00428 
00429 
00430 <font class="keywordtype">void</font> kmencoderdlgForm::setplaylistgroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00431 <font class="keyword"></font>{
00432     playlistGroupBox-&gt;setEnabled( set_it );
00433 }
00434 
00435 
00436 <font class="keywordtype">void</font> kmencoderdlgForm::seturlgroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00437 <font class="keyword"></font>{
00438     urlGroupBox-&gt;setEnabled( set_it ); 
00439     urlKURLRequester-&gt;setEnabled( set_it );    
00440 }
00441 
00442 
00443 <font class="keywordtype">void</font> kmencoderdlgForm::setvcdgroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00444 <font class="keyword"></font>{
00445     vcdGroupBox-&gt;setEnabled( set_it );
00446     vcdtrackSpinBox-&gt;setEnabled( set_it );
00447     cdromdeviceKURLRequester-&gt;setEnabled( TRUE );
00448     
00449     cdromdeviceKURLRequester-&gt;setURL( vcdinfo.getVCDDevice() );
00450 }
00451 
00452 
00453 <font class="keywordtype">void</font> kmencoderdlgForm::settvgroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00454 <font class="keyword"></font>{
00455     tvGroupBox-&gt;setEnabled( set_it ); 
00456 }
00457 
00458 
00459 <font class="keywordtype">void</font> kmencoderdlgForm::setvideogroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00460 <font class="keyword"></font>{
00461     videosizeComboBox-&gt;setEnabled( set_it );
00462     widthheightGroupBox-&gt;setEnabled( set_it );
00463     divx4GroupBox-&gt;setEnabled( set_it ); 
00464     lavcGroupBox-&gt;setEnabled( set_it ); 
00465     videosizeDefaults(); 
00466 }
00467 
00468 
00469 <font class="keywordtype">void</font> kmencoderdlgForm::readFromStderr()<font class="keyword"></font>
00470 <font class="keyword"></font>{
00471     <font class="comment">//Write to the STDERR TextEdit</font>
00472     stderrTextEdit-&gt;append( proc-&gt;readStderr() ); 
00473 }
00474 
00475 <font class="keywordtype">void</font> kmencoderdlgForm::getDVDInfo()<font class="keyword"></font>
00476 <font class="keyword"></font>{
00477     <font class="comment">//GET Important Info of the DVD.  Titles, chapters, angles, audio channels, subtitles.</font>
00478     uint i = 0;
00479     uint j = 0;
00480     uint audio = 0;
00481     uint subt = 0;
00482 
00483     KStringHandler catched;
00484     QString catched2 = <font class="stringliteral">"Start"</font>;
00485     QString catched3 = proc-&gt;readStderr();
00486     QString output_text = catched3.simplifyWhiteSpace();
00487 
00488     <font class="comment">//Start Searching in the mencoder output for info.</font>
00489     <font class="keywordflow">while</font>( output_text.length() &gt; i ) {
00490     catched2 = catched.word( output_text , i);
00491     
00492     <font class="keywordflow">if</font> (  catched2 == <font class="stringliteral">"There"</font> &amp;&amp; catched.word(output_text, i + 3) == <font class="stringliteral">"titles"</font> )
00493         dvdinfo.setTitles( catched.word(output_text, i + 2) );
00494     
00495     <font class="keywordflow">if</font> (  catched2 == <font class="stringliteral">"There"</font> &amp;&amp; catched.word(output_text, i + 3) == <font class="stringliteral">"chapters"</font> )
00496         dvdinfo.setChapters( catched.word(output_text, i + 2) );
00497     
00498     <font class="keywordflow">if</font> (  catched2 == <font class="stringliteral">"There"</font> &amp;&amp; catched.word(output_text, i + 3) == <font class="stringliteral">"angles"</font> )
00499         dvdinfo.setAngles( catched.word(output_text, i + 2) );
00500     
00501     <font class="keywordflow">if</font> (  catched2 == <font class="stringliteral">"aid:"</font> ) {
00502         dvdAinfo[audio].setChannel( catched.word(output_text, i + 1) );
00503         dvdAinfo[audio].setLanguage( catched.word(output_text, i - 1) );
00504         dvdAinfo[audio].setFormat( catched.word(output_text, i - 3) );
00505         dvdAinfo[audio].setIndex( audio );
00506         audio++;
00507     }
00508     
00509     <font class="keywordflow">if</font>( catched2 == <font class="stringliteral">"sid"</font> ) {
00510         dvdSinfo[ subt ].setID( catched.word(output_text, i + 2) );
00511         dvdSinfo[ subt ].setLanguage( catched.word(output_text, i + 4) );
00512         dvdSinfo[ subt ].setIndex( subt );
00513         subt++;
00514     } 
00515     i++;
00516     }
00517     
00518     <font class="comment">//set info limits.</font>
00519     dvdtittleSpinBox-&gt;setMaxValue( dvdinfo.getTitles() ); 
00520     dvdangleSpinBox-&gt;setMaxValue( dvdinfo.getAngles() ); 
00521     dvd1stchapterSpinBox-&gt;setMaxValue( dvdinfo.getChapters() ); 
00522     dvdlastchapterSpinBox-&gt;setMaxValue( dvdinfo.getChapters() ); 
00523     
00524     <font class="keywordflow">for</font>( j = 0; j &lt; audio; j++)
00525     achannelComboBox-&gt;insertItem( dvdAinfo[j].getChannel() <font class="comment">/* , dvdAinfo[j].getIndex() */</font> );
00526     <font class="keywordflow">if</font>(audio != 0)
00527     manageSelectAudioChannel();
00528     
00529     <font class="keywordflow">for</font>(j = 0; j &lt; subt; j++)
00530     subtitleComboBox-&gt;insertItem( dvdSinfo[j].getID() <font class="comment">/*, dvdSinfo[j].getIndex() */</font>); 
00531     <font class="keywordflow">if</font>(subt != 0)
00532     manageSubTitlesComboBox();
00533 }
00534 
00535 
00536 <font class="keywordtype">void</font> kmencoderdlgForm::manageSelectAudioChannel()<font class="keyword"></font>
00537 <font class="keyword"></font>{
00538     <font class="keywordtype">bool</font> select = FALSE;
00539     uint i = 0;
00540     
00541     <font class="keywordflow">while</font>( !select ){
00542     <font class="keywordflow">if</font>( (achannelComboBox-&gt;currentText () ).compare( dvdAinfo[i].getChannel() ) == 0 ) {
00543         dvdinfo.setDVDAudioChannel( dvdAinfo[i].getChannel() );
00544         audiolanguageLineEdit-&gt;setText( dvdAinfo[i].getLanguage() );
00545         audioformatLineEdit-&gt;setText( dvdAinfo[i].getFormat() );    
00546         select = TRUE;  
00547     }
00548     i++;
00549     }
00550 }
00551 
00552 
00553 <font class="keywordtype">void</font> kmencoderdlgForm::stop()<font class="keyword"></font>
00554 <font class="keyword"></font>{
00555     <font class="keywordflow">if</font>( KMenConfig::proc_loaded == 1 ) {
00556     <font class="keywordflow">if</font>( proc-&gt;isRunning() == TRUE ){
00557         proc-&gt;tryTerminate();
00558         QTimer::singleShot( 5000, proc, SLOT( kill() ) );
00559         <font class="keyword">delete</font> proc;
00560         KMenConfig::proc_loaded = 0;
00561     }
00562     <font class="keywordflow">else</font> {
00563         <font class="keyword">delete</font> proc;
00564         KMenConfig::proc_loaded = 0;
00565     }
00566     }
00567     KMenConfig::proc_loaded = 0;
00568     KMenConfig::stopped = 1;
00569 }
00570 
00571 
00572 <font class="keywordtype">void</font> kmencoderdlgForm::manageSubTitlesComboBox()<font class="keyword"></font>
00573 <font class="keyword"></font>{
00574     <font class="keywordtype">bool</font> select = FALSE;
00575     uint i = 0;
00576 
00577     <font class="keywordflow">while</font>( !select ){
00578     <font class="keywordflow">if</font>( (subtitleComboBox-&gt;currentText () ).compare( dvdSinfo[i].getID() ) == 0 ) {
00579         dvdinfo.setDVDSubTitle( dvdSinfo[i].getID() );      
00580         subposLineEdit-&gt;setText( dvdSinfo[i].getLanguage() );
00581         select = TRUE;  
00582     }
00583     i++;
00584     }
00585 }
00586 
00587 
00588 <font class="keywordtype">void</font> kmencoderdlgForm::manageWidthChanged()<font class="keyword"></font>
00589 <font class="keyword"></font>{
00590     videoinfo.setVideoWidth( widthSpinBox-&gt;text() );
00591     videoinfo.setVideoHeight( heightSpinBox-&gt;text() );
00592     videoinfo.setVideoAspectMode( aspectComboBox-&gt;currentText () );
00593 }
00594     
00595 
00596 <font class="keywordtype">void</font> kmencoderdlgForm::manageTitleChanged()<font class="keyword"></font>
00597 <font class="keyword"></font>{
00598     dvdinfo.setDVDTitle_selected( dvdtittleSpinBox-&gt;text() );
00599     dvdinfo.setDVDAngle_selected( dvdangleSpinBox-&gt;text() );
00600     dvdinfo.setDVDChapter_selected( dvd1stchapterSpinBox-&gt;text(), dvdlastchapterSpinBox-&gt;text() );
00601     dvdinfo.setDVDSubPos( subtitlepositionSlider-&gt;value() );
00602 }
00603 
00604 
00605 <font class="keywordtype">void</font> kmencoderdlgForm::manageLavcCodecChanged()<font class="keyword"></font>
00606 <font class="keyword"></font>{
00607     manageVBitrateChanged();
00608 }
00609 
00610 
00611 <font class="keywordtype">void</font> kmencoderdlgForm::manageDivx4CodecChanged()<font class="keyword"></font>
00612 <font class="keyword"></font>{
00613     manageVBitrateChanged();    
00614 }
00615 
00616 
00617 <font class="keywordtype">void</font> kmencoderdlgForm::manageMp3Changed()<font class="keyword"></font>
00618 <font class="keyword"></font>{
00619     soundinfo.setSoundLameOpts( bitrateComboBox-&gt;currentText (),
00620                 lameSpinBox-&gt;text(),
00621                 amodeComboBox-&gt;currentText (),
00622                 lamecompresratioSpinBox-&gt;text() ,
00623                 volumeSlider-&gt;value() );
00624 }
00625 
00626 
00627 <font class="keywordtype">void</font> kmencoderdlgForm::manageSoundOnCheckBox()<font class="keyword"></font>
00628 <font class="keyword"></font>{
00629     soundinfo.setSoundON( ! nosoundCheckBox-&gt;isChecked() );
00630 }
00631 
00632 
00633 <font class="keywordtype">void</font> kmencoderdlgForm::manageMiscChanged()<font class="keyword"></font>
00634 <font class="keyword"></font>{ 
00635     miscinfo.setMiscNoSkip( noskipCheckBox-&gt;isChecked() );
00636     miscinfo.setMiscVerbose( verboseCheckBox-&gt;isChecked()  );
00637     miscinfo.setEndPos_enabled( endpositionCheckBox-&gt;isChecked() );
00638     
00639     miscinfo.setMiscCache( cacheSpinBox-&gt;text() );
00640     miscinfo.setMiscEndPosMega( endpositionmegaSpinBox-&gt;text() );
00641     miscinfo.setMiscEndPosTime( endpositionhourSpinBox-&gt;text(),
00642                 endpositionminutesSpinBox-&gt;text(),
00643                 endpositionsecondsSpinBox-&gt;text() );
00644 }
00645 
00646 
00647 <font class="keywordtype">void</font> kmencoderdlgForm::preview()<font class="keyword"></font>
00648 <font class="keyword"></font>{
00649     start_encode = FALSE;
00650     endpos = FALSE;
00651     prebegin();
00652 }
00653 
00654 
00655 <font class="keywordtype">void</font> kmencoderdlgForm::begin()<font class="keyword"></font>
00656 <font class="keyword"></font>{
00657     new_proc();
00658     KMenConfig::stopped = 0;
00659     proc-&gt;addArgument( turn.getExec() );
00660     <font class="keywordflow">try</font> {
00661     <font class="keywordflow">switch</font>( kmenselected.getSource() ) {
00662         <font class="keywordflow">case</font> srcSELECT_SOURCE: {
00663         <font class="keywordflow">throw</font> KMenNotSet( tr2i18n( <font class="stringliteral">"SOURCE"</font> ) );
00664         <font class="keywordflow">break</font>;
00665         }
00666         <font class="keywordflow">case</font> srcFILE: {
00667         <font class="keywordflow">if</font>( fileinfo.setFileArguments( proc ) != TRUE )
00668             <font class="keywordflow">throw</font> KMenNotSet( tr2i18n( <font class="stringliteral">"INput File"</font> ) );
00669         <font class="keywordflow">break</font>;
00670         }
00671         <font class="keywordflow">case</font> srcPLAYLIST: {
00672         <font class="keywordflow">break</font>;
00673         }
00674         <font class="keywordflow">case</font> srcURL: {
00675         <font class="keywordflow">if</font> ( urlinfo.setURLArguments( proc ) != TRUE )
00676             <font class="keywordflow">throw</font> KMenNotSet( tr2i18n( <font class="stringliteral">"URL Address"</font> ) ) ;
00677         <font class="keywordflow">break</font>;
00678         }
00679         <font class="keywordflow">case</font> srcTV: {
00680         <font class="keywordflow">break</font>;
00681         }
00682         <font class="keywordflow">case</font> srcVCD: {
00683         vcdinfo.setVCDArguments( proc );
00684         <font class="keywordflow">break</font>;
00685         }
00686         <font class="keywordflow">case</font> srcDVD: {
00687         dvdinfo.setDVDArguments( nosoundCheckBox-&gt;isChecked(),
00688                      enablesubCheckBox-&gt;isChecked(), proc );
00689         <font class="keywordflow">break</font>;
00690         }
00691         <font class="keywordflow">default</font>: {
00692         <font class="keywordflow">break</font>;
00693         }
00694     }
00695     
00696     miscinfo.setMiscArguments( proc );
00697     
00698     videoinfo.setVideoArguments( proc, kmenselected );  
00699     manageLavcCodecChanged();
00700     
00701     soundinfo.setSoundArguments( proc, kmenselected );
00702     
00703     proc-&gt;setCommunication( 0x02 | 0x04 <font class="comment">/*| 0x08*/</font> );
00704     
00705     <font class="keywordflow">if</font>( start_encode == TRUE ) {
00706         <font class="keywordflow">if</font>( turn.setOutputFileArguments( proc ) != TRUE )
00707         <font class="keywordflow">throw</font> KMenNotSet( tr2i18n( <font class="stringliteral">"OUTput File"</font> ) );
00708            
00709 <font class="comment">//-------&gt;      //set progress bar, output stdout stuff.</font>
00710         connect( proc, SIGNAL(readyReadStderr()),
00711              <font class="keyword">this</font>, SLOT( encode_output() ) );       
00712         <font class="comment">//run this when completed.</font>
00713         connect( proc, SIGNAL( processExited() ),
00714              <font class="keyword">this</font>, SLOT( encode_exit() ) ); 
00715     }
00716     <font class="keywordflow">else</font> {
00717         <font class="comment">//enable disabled stuff when preview.</font>
00718         connect( proc, SIGNAL( processExited() ),
00719              <font class="keyword">this</font>, SLOT( manageEnableControls() ) );  
00720         <font class="comment">//output stdout stuff.</font>
00721         connect( proc, SIGNAL(readyReadStdout()),
00722              <font class="keyword">this</font>, SLOT( readFromStdout() ) );
00723     }
00724 
00725     <font class="keywordflow">if</font>( miscinfo.getMiscVerbose() == TRUE ) {
00726         <font class="comment">//show the stdout stuff.</font>
00727         connect( proc, SIGNAL(readyReadStderr()),
00728              <font class="keyword">this</font>, SLOT( readFromStderr() ) );
00729     }   
00730     }
00731     
00732     <font class="keywordflow">catch</font> ( <a class="code" href="classKMenError.html">KMenError</a>&amp; theError )
00733     {
00734     stop();
00735     theError.PrintError();
00736     <font class="keywordflow">return</font>;
00737     }
00738     
00739     <font class="keywordflow">catch</font> ( ... )
00740     {
00741     stop();
00742     QMessageBox::critical( 0, tr2i18n( <font class="stringliteral">"Error"</font> ), tr2i18n( <font class="stringliteral">"Not Identified Error!"</font> ) );
00743     <font class="keywordflow">return</font>;
00744     }
00745     
00746 <font class="comment">//------&gt;    //Get Pass Recomended video bitrate.</font>
00747     <font class="keywordflow">if</font>( videoinfo.getVideoPassCount() == 1 &amp;&amp; videoinfo.getVideoPass() == TRUE  &amp;&amp; 
00748     start_encode == TRUE ) {
00749     connect( proc, SIGNAL( readyReadStdout() ),
00750          <font class="keyword">this</font>, SLOT( getBitratePassInfo() ) ); 
00751     turn.deleteTmpFiles();
00752     }
00753     
00754     <font class="comment">//Repeat encode in pass 1 and pass 2 after the audio encode. If not stopped!</font>
00755     <font class="keywordflow">if</font>( videoinfo.getVideoPassCount() != 0  &amp;&amp; videoinfo.getVideoPass() == TRUE &amp;&amp;
00756     start_encode == TRUE ) 
00757     connect( proc, SIGNAL( processExited() ),
00758          <font class="keyword">this</font>, SLOT( permission2begin() ) ); 
00759 
00760     connect( proc, SIGNAL( processExited() ),
00761          <font class="keyword">this</font>, SLOT( renameFile() ) ); 
00762     
00763     <font class="comment">//Set Misc Settings.  In case something was changed to comply.</font>
00764     connect( proc, SIGNAL( processExited() ),
00765          <font class="keyword">this</font>, SLOT( manageMiscChanged() ) );
00766     
00767     <font class="comment">//Set the pass settings, in case mplayer is used or the new bitrate was set!</font>
00768     connect( proc, SIGNAL( processExited() ),
00769          <font class="keyword">this</font>, SLOT( forward_pass() ) );
00770     
00771     <font class="comment">//check the args created! just for debug!</font>
00772     doneListBox-&gt;insertStringList( proc-&gt;arguments() );
00773 
00774     <font class="comment">//START process</font>
00775     start_proc();
00776 }
00777 
00778 
00779 <font class="keywordtype">void</font> kmencoderdlgForm::prebegin()<font class="keyword"></font>
00780 <font class="keyword"></font>{
00781     turn.setPreview( start_encode );
00782 
00783     videoinfo.setVideoEncode_enabled( start_encode );
00784     soundinfo.setSoundEncode_enabled( start_encode );
00785         
00786     miscinfo.setEndPos_enabled( endpos );
00787     videoinfo.setVideoEncode_enabled( start_encode );
00788         
00789     begin();
00790 }
00791 
00792 
00793 <font class="keywordtype">void</font> kmencoderdlgForm::manageDVDChanged()<font class="keyword"></font>
00794 <font class="keyword"></font>{
00795     dvdinfo.setDVDDevice( dvddeviceKURLRequester-&gt;url() );
00796 }
00797 
00798 
00799 <font class="keywordtype">void</font> kmencoderdlgForm::manageListBoxDone()<font class="keyword"></font>
00800 <font class="keyword"></font>{
00801     doneListBox-&gt;insertItem( otputKURLRequester-&gt;url(), 0 ) ;
00802     encodingProgressBar-&gt;reset();
00803     <font class="comment">//encodingProgressBar-&gt;setProgress( 0 );</font>
00804     progress_on = FALSE;
00805 }
00806 
00807 
00808 <font class="keywordtype">void</font> kmencoderdlgForm::manageProgressBar()<font class="keyword"></font>
00809 <font class="keyword"></font>{
00810     QString catched = proc-&gt;readStderr(); 
00811     QString output_text = catched.simplifyWhiteSpace();
00812    ushort indx = output_text.find( <font class="charliteral">'%'</font>, 0, TRUE);
00813     catched = output_text.mid( indx - 2, 2 );
00814     indx = catched.toInt();
00815     <font class="keywordflow">if</font>( indx &gt; 99) indx = 100;
00816     <font class="keywordflow">if</font>( indx &lt;= 100 &amp;&amp; indx &gt; encodingProgressBar-&gt;progress()  || progress_on == FALSE )
00817     encodingProgressBar-&gt;setProgress( indx );
00818     <font class="comment">//outputTextEdit-&gt;append( output_text );</font>
00819     progress_on = TRUE;
00820 }
00821 
00822 
00823 <font class="keywordtype">void</font> kmencoderdlgForm::manageEnableControls()<font class="keyword"></font>
00824 <font class="keyword"></font>{
00825     startPushButton-&gt;setEnabled( TRUE );
00826     previewPushButton-&gt;setEnabled( TRUE );
00827     optionsTabWidget-&gt;setEnabled( TRUE );
00828 }
00829 
00830 
00831 <font class="keywordtype">void</font> kmencoderdlgForm::getFileGroupStuff()<font class="keyword"></font>
00832 <font class="keyword"></font>{
00833     fileinfo.setFileName( fileKURLRequester-&gt;url() );
00834 }
00835 
00836 
00837 <font class="keywordtype">void</font> kmencoderdlgForm::getURLGroupStuff()<font class="keyword"></font>
00838 <font class="keyword"></font>{
00839     urlinfo.setURLName( urlKURLRequester-&gt;url() );
00840 }
00841 
00842 
00843 <font class="keywordtype">void</font> kmencoderdlgForm::new_proc()<font class="keyword"></font>
00844 <font class="keyword"></font>{
00845     stop();
00846     proc = <font class="keyword">new</font> QProcess( <font class="keyword">this</font> );
00847     KMenConfig::proc_loaded = 1;
00848     proc-&gt;setCommunication( 0x02 | 0x04 <font class="comment">/*| 0x08 */</font>);
00849     move2dir();
00850     proc-&gt;setWorkingDirectory( tmp_dir );
00851 }
00852 
00853 
00854 <font class="keywordtype">void</font> kmencoderdlgForm::setgroups()<font class="keyword"></font>
00855 <font class="keyword"></font>{
00856     setdvdgroup( FALSE );
00857     setendpositiongroup( FALSE );
00858     setfilegroup( FALSE );
00859     setplaylistgroup( FALSE );
00860     seturlgroup( FALSE );
00861     setvcdgroup( FALSE );
00862     settvgroup( FALSE );
00863  
00864     <font class="keywordflow">switch</font>( kmenselected.getSource() ) {
00865     <font class="keywordflow">case</font> srcFILE: {
00866         setfilegroup( TRUE );
00867         setendpositiongroup( TRUE );    
00868         <font class="keywordflow">break</font>;
00869     }
00870     <font class="keywordflow">case</font> srcPLAYLIST: {
00871         setplaylistgroup( TRUE );
00872         <font class="keywordflow">break</font>;
00873     }
00874     <font class="keywordflow">case</font> srcURL: {
00875         seturlgroup( TRUE );
00876         setendpositiongroup( TRUE );
00877         <font class="keywordflow">break</font>;
00878     }
00879     <font class="keywordflow">case</font> srcTV: {
00880         settvgroup( TRUE );
00881         <font class="keywordflow">break</font>;
00882     }
00883     <font class="keywordflow">case</font> srcVCD: {
00884         setvcdgroup( TRUE );
00885         setendpositiongroup( TRUE );
00886         <font class="keywordflow">break</font>;
00887     }
00888     <font class="keywordflow">case</font> srcDVD: {
00889         setdvdgroup( TRUE );
00890         setendpositiongroup( TRUE );
00891         <font class="keywordflow">break</font>;
00892     }
00893     <font class="keywordflow">default</font>: <font class="keywordflow">break</font>;
00894          }
00895 }
00896 
00897 
00898 <font class="keywordtype">void</font> kmencoderdlgForm::vcd_scan()<font class="keyword"></font>
00899 <font class="keyword"></font>{
00900    new_proc();
00901     
00902     QString dir = tmp_dir + <font class="stringliteral">"/kmencoder_test.avi"</font>;
00903     
00904     proc-&gt;addArgument( <font class="stringliteral">"mencoder"</font> );
00905     proc-&gt;addArgument( <font class="stringliteral">"-cdrom-device"</font> );
00906     proc-&gt;addArgument( vcdinfo.getVCDDevice() );
00907     proc-&gt;addArgument( <font class="stringliteral">"-vcd"</font> );
00908     proc-&gt;addArgument( <font class="stringliteral">"1"</font> ) ;
00909     proc-&gt;addArgument( <font class="stringliteral">"-v"</font> );
00910     proc-&gt;addArgument( <font class="stringliteral">"-o"</font> );
00911     proc-&gt;addArgument( dir );
00912 
00913     proc-&gt;setCommunication ( 0x04 );
00914 
00915     connect( proc, SIGNAL(readyReadStderr()),
00916          <font class="keyword">this</font>, SLOT(getVCDInfo() ));    
00917 
00918     <font class="comment">//Sart the process.</font>
00919     <font class="keywordflow">if</font> ( !proc-&gt;start() ) {
00920     <font class="comment">// error handling</font>
00921     QMessageBox::critical( 0,
00922                   tr2i18n( <font class="stringliteral">"Error"</font> ),
00923                   tr2i18n( <font class="stringliteral">"Could not scan the VCD!"</font> ) );
00924     } 
00925 }
00926 
00927 
00928 <font class="keywordtype">void</font> kmencoderdlgForm::getVCDInfo()<font class="keyword"></font>
00929 <font class="keyword"></font>{
00930    <font class="comment">//GET Important Info of the VCD. tracks </font>
00931     QString catched = proc-&gt;readStderr(); 
00932     QString output_text = catched.simplifyWhiteSpace();
00933     QString track = <font class="stringliteral">"track"</font>;
00934    ushort indx = output_text.find( track, 0, TRUE);
00935     catched = output_text.mid( indx + 6, 2 );
00936     indx = catched.toInt();
00937     
00938     <font class="keywordflow">if</font>( catched != NULL ) vcdinfo.setVCDTrack( catched );
00939 
00940     <font class="comment">//set info limits.</font>
00941     vcdtrackSpinBox-&gt;setMaxValue( (vcdinfo.getVCDTrack()).toInt() );
00942     <font class="comment">//vcdinfo.setVCDTrack( vcdtrackSpinBox-&gt;text() );</font>
00943 }
00944 
00945 
00946 <font class="keywordtype">void</font> kmencoderdlgForm::manageTrackChanged()<font class="keyword"></font>
00947 <font class="keyword"></font>{
00948     vcdinfo.setVCDTrack( vcdtrackSpinBox-&gt;text() );
00949 }
00950 
00951 
00952 <font class="keywordtype">void</font> kmencoderdlgForm::manageCdromChanged()<font class="keyword"></font>
00953 <font class="keyword"></font>{
00954     vcdinfo.setVCDDevice( cdromdeviceKURLRequester-&gt;url() );
00955 }
00956 
00957 
00958 <font class="keywordtype">void</font> kmencoderdlgForm::setpassgroup( <font class="keywordtype">bool</font> set_it )<font class="keyword"></font>
00959 <font class="keyword"></font>{
00960     passmethodComboBox-&gt;setEnabled( set_it );
00961     <font class="keywordflow">if</font>( set_it == TRUE ) {
00962     vqualityComboBox-&gt;setCurrentText( tr2i18n( <font class="stringliteral">"lavc"</font> ) );
00963     lavccodecComboBox-&gt;setCurrentText( tr2i18n( <font class="stringliteral">"DivX 4/5"</font> ) );
00964     
00965     <font class="comment">//manageLavcCodecChanged();</font>
00966     endpositionCheckBox-&gt;setChecked( FALSE );
00967     miscinfo.setEndPos_enabled( FALSE );
00968     }
00969     vqualityComboBox-&gt;setDisabled( set_it );    
00970     lavccodecComboBox-&gt;setDisabled( set_it );
00971     videobitrateSpinBox-&gt;setDisabled( set_it );
00972     videoinfo.setVideoPass( set_it );
00973     soundinfo.setSoundPass( set_it );
00974     turn.setConfPass( set_it );
00975 }
00976 
00977 
00978 <font class="keywordtype">void</font> kmencoderdlgForm::start_proc()<font class="keyword"></font>
00979 <font class="keyword"></font>{
00980     <font class="comment">//START process</font>
00981     <font class="keywordflow">if</font> ( !proc-&gt;start() ) {
00982     <font class="comment">// error handling</font>
00983     <font class="keywordflow">if</font>( start_encode == TRUE )
00984     QMessageBox::critical( 0,
00985                   tr2i18n( <font class="stringliteral">"Error"</font> ),
00986                   tr2i18n( <font class="stringliteral">"Can't Begin mencoder!"</font> ) );
00987     <font class="keywordflow">else</font> QMessageBox::critical( 0,
00988                    tr2i18n( <font class="stringliteral">"Error"</font> ),
00989                    tr2i18n( <font class="stringliteral">"Can't Begin mplayer!"</font> ) );
00990     }  
00991     <font class="keywordflow">else</font> {
00992     optionsTabWidget-&gt;setEnabled( FALSE );
00993     startPushButton-&gt;setEnabled( FALSE );
00994     previewPushButton-&gt;setEnabled( FALSE );
00995     }  
00996 }
00997 
00998 
00999 <font class="keywordtype">void</font> kmencoderdlgForm::getBitratePassInfo()<font class="keyword"></font>
01000 <font class="keyword"></font>{
01001     <font class="comment">//GET Important Info for the Pass Method.</font>
01002     QString size = passmethodComboBox-&gt;currentText();
01003     QString catched2 = proc-&gt;readStdout();
01004     QString output_text = catched2.simplifyWhiteSpace();
01005     
01006     <font class="keywordtype">int</font> tmp = output_text.find( size, 0 ) +10;
01007     <font class="keywordtype">int</font> tmp2 = output_text.find( <font class="stringliteral">" "</font>, tmp );
01008     catched2 = output_text.mid( tmp, tmp2 - tmp );
01009     <font class="keywordflow">if</font>( catched2 != NULL ) {
01010     videobitrateSpinBox-&gt;setValue( catched2.toInt() );
01011     videoinfo.setVideoBitrate( catched2 );
01012     <font class="comment">//cout &lt;&lt; catched2 &lt;&lt; endl;</font>
01013     <font class="comment">//cout &lt;&lt; tmp &lt;&lt; " " &lt;&lt; tmp2 &lt;&lt; endl;</font>
01014     }  
01015     <font class="comment">//cout &lt;&lt;  output_text &lt;&lt; endl;</font>
01016 }
01017 
01018 
01019 <font class="keywordtype">void</font> kmencoderdlgForm::move2dir()<font class="keyword"></font>
01020 <font class="keyword"></font>{
01021     home_env = getenv( <font class="stringliteral">"HOME"</font> );
01022     home_env = home_env + <font class="stringliteral">"/.kmencoder"</font>;
01023     
01024     <font class="keywordflow">if</font>( access( home_env, R_OK | W_OK | X_OK | F_OK ) != 0 ){
01025     <font class="keywordflow">if</font>( mkdir( home_env,  S_IRWXU ) != 0 ) {
01026         QMessageBox::critical( 0,  tr2i18n( <font class="stringliteral">"Error"</font> ), tr2i18n( <font class="stringliteral">"Error with config directory!"</font> ) );
01027         <font class="keywordflow">return</font>;
01028     }
01029     }
01030     tmp_dir = home_env + <font class="stringliteral">"/tmp"</font>;
01031     <font class="keywordflow">if</font>( access( tmp_dir, R_OK | W_OK | X_OK | F_OK ) != 0 ) {
01032     <font class="keywordflow">if</font>( mkdir( tmp_dir,  S_IRWXU ) != 0 ) {
01033         QMessageBox::critical( 0, tr2i18n( <font class="stringliteral">"Error"</font> ), tr2i18n( <font class="stringliteral">"Error with tmp directory!"</font> ) );
01034         <font class="keywordflow">return</font>;
01035     }
01036     }
01037     turn.setConfDir( tmp_dir );
01038 }
01039 
01040 
01041 <font class="keywordtype">void</font> kmencoderdlgForm::forward_pass()<font class="keyword"></font>
01042 <font class="keyword"></font>{
01043     setpassgroup( passmethodCheckBox-&gt;isChecked() );
01044 }
01045 
01046 
01047 <font class="keywordtype">void</font> kmencoderdlgForm::encode_exit()<font class="keyword"></font>
01048 <font class="keyword"></font>{
01049     <font class="comment">//tell what was finished.</font>
01050     manageListBoxDone(); 
01051     <font class="comment">//enable the disabled stuff</font>
01052     manageEnableControls();
01053 }
01054 
01055 
01056 <font class="keywordtype">void</font> kmencoderdlgForm::encode_output()<font class="keyword"></font>
01057 <font class="keyword"></font>{
01058     <font class="comment">//set progressbar</font>
01059     manageProgressBar();
01060     
01061     <font class="comment">//output stdout stuff.</font>
01062     readFromStderr();
01063 }
01064 
01065 
01066 <font class="keywordtype">void</font> kmencoderdlgForm::manageVBitrateChanged()<font class="keyword"></font>
01067 <font class="keyword"></font>{
01068     videoinfo.setVideoBitrate( videobitrateSpinBox-&gt;text() );
01069     
01070     <font class="keywordflow">if</font>(vqualityComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"DivX 4"</font> ) )
01071     videoinfo.setVideoDivx4Opts( divx4qualitySpinBox-&gt;text() );
01072     <font class="keywordflow">if</font>(vqualityComboBox-&gt;currentText () == tr2i18n( <font class="stringliteral">"lavc"</font> ) )
01073     videoinfo.setVideoLavcOpts( lavccodecComboBox-&gt;currentText (),
01074                 lavchighqualityCheckBox-&gt;isChecked() );
01075 }
01076 
01077 
01078 <font class="keywordtype">void</font> kmencoderdlgForm::permission2begin()<font class="keyword"></font>
01079 <font class="keyword"></font>{
01080     <font class="keywordflow">if</font>( KMenConfig::stopped == 1 ) {
01081     videoinfo.setVideoPassCount( 0 );
01082     soundinfo.setSoundPassCount( 0 );
01083     KMenConfig::stopped = 0;
01084     }
01085     <font class="keywordflow">else</font> begin();
01086 }
01087 
01088 
01089 <font class="keywordtype">void</font> kmencoderdlgForm::renameFile()<font class="keyword"></font>
01090 <font class="keyword"></font>{
01091     turn.setConfOutRename();
01092 }
</pre></div><hr><address><small>Generated at Mon Jul 29 23:59:15 2002 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.8.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
